<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vision + 4 Areas</title>
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#000000" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      html, body, #root { height: 100%; }
      body { background: #fafafa; }
      .btn { padding: 4px 8px; border-radius: 10px; background: #f3f4f6; }
      .btn-red { background: #fef2f2; color: #b91c1c; }
      .icon { font-style: normal; }
      .tip { font-size: 12px; color: #6b7280; }
      .bar { position: sticky; top: 0; z-index: 50; backdrop-filter: blur(6px); background: rgba(250,250,250,0.8); border-bottom: 1px solid #e5e7eb; }
      .nav { position: fixed; bottom: 0; inset-inline: 0; z-index: 50; background: white; border-top: 1px solid #e5e7eb; box-shadow: 0 -1px 3px rgba(0,0,0,0.03); }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

    <script>
      (function(){
        const { useState, useEffect, useRef } = React;
        const e = React.createElement;

        const STORAGE_KEY = "vb_weekly_tracker_v1";
        function uid(){ return Math.random().toString(36).slice(2, 10) + Date.now().toString(36).slice(-4); }
        const DEFAULT_AREAS = [
          { id: uid(), name: "ëˆ/ì¼ (Wealth/Work)", color: "bg-emerald-50", goals: [] },
          { id: uid(), name: "ì‹ ì•™ (Faith)", color: "bg-indigo-50", goals: [] },
          { id: uid(), name: "ê°€ì¡± (Family)", color: "bg-rose-50", goals: [] },
          { id: uid(), name: "ë‚˜ (Self)", color: "bg-amber-50", goals: [] },
        ];
        function startOfWeek(date = new Date()) { const d = new Date(date); const day = (d.getDay()+6)%7; d.setDate(d.getDate()-day); d.setHours(0,0,0,0); return d; }
        function formatWeek(d){ const end = new Date(d); end.setDate(end.getDate()+6); const f = x => x.toLocaleDateString(undefined,{month:"short", day:"numeric"}); return `${f(d)} â€“ ${f(end)}`; }
        function deepClone(x){ return JSON.parse(JSON.stringify(x)); }
        function resetCompletion(node){ if(node.completed) node.completed=false; if(Array.isArray(node.subtasks)) node.subtasks.forEach(resetCompletion); if(Array.isArray(node.actions)) node.actions.forEach(resetCompletion); if(Array.isArray(node.goals)) node.goals.forEach(resetCompletion); return node; }
        function countProgress(area){ let total=0,done=0; for(const g of area.goals){ total++; if(g.completed) done++; for(const a of g.actions||[]){ total++; if(a.completed) done++; for(const s of a.subtasks||[]){ total++; if(s.completed) done++; }}} return {total,done}; }
        function isiOS(){ return /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1); }

        function useLocalStorage(key, initialValue){
          const [value, setValue] = useState(() => {
            try { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : initialValue; }
            catch { return initialValue; }
          });
          useEffect(() => { localStorage.setItem(key, JSON.stringify(value)); }, [key, value]);
          return [value, setValue];
        }

        function createInitialDB(){
          const week0 = startOfWeek(new Date());
          const areas = deepClone(DEFAULT_AREAS);
          areas[0].goals = [{ id: uid(), title: "ë§¤ì¶œ íŒŒì´í”„ë¼ì¸ ì ê²€", completed: false, actions:[{ id: uid(), title: "ìž ìž¬ê³ ê° 10ê±´ ì½œë“œë¦¬ì¹˜", completed:false, subtasks:[{id:uid(), title:"ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸", completed:false}, {id:uid(), title:"ìŠ¤í¬ë¦½íŠ¸ ë‹¤ë“¬ê¸°", completed:false}]}]}];
          areas[1].goals = [{ id: uid(), title: "ë§¤ì¼ 10ë¶„ ë¬µìƒ", completed: false, actions: [] }];
          areas[2].goals = [{ id: uid(), title: "ê°€ì¡± ì €ë… 2íšŒ", completed: false, actions: [{ id: uid(), title: "ìˆ˜ìš”ì¼ ì¼ì • ë¹„ìš°ê¸°", completed:false, subtasks: [] }]}];
          areas[3].goals = [{ id: uid(), title: "ì£¼ 3íšŒ ìš´ë™", completed: false, actions: [{ id: uid(), title: "ì›”/ìˆ˜/ê¸ˆ ì˜¤ì „ 7ì‹œ", completed:false, subtasks: [] }]}];
          const db = { vision: { imageDataUrl: "", imageUrl: "" }, weeks: [{ id: uid(), weekStartISO: week0.toISOString(), areas, notes: "" }], activeWeekId: null };
          db.activeWeekId = db.weeks[0].id; return db;
        }

        function App(){
          const [db, setDb] = useLocalStorage(STORAGE_KEY, createInitialDB());
          const [page, setPage] = useState("dashboard");
          const [vision, setVision] = useState(db.vision || { imageDataUrl: "", imageUrl: "" });
          const [activeWeekId, setActiveWeekId] = useState(db.activeWeekId);
          const activeWeek = db.weeks.find((w) => w.id === activeWeekId) || db.weeks[0];

          useEffect(()=>{ setDb(prev=>({ ...prev, vision })); }, [vision.imageDataUrl, vision.imageUrl]);
          useEffect(()=>{ setDb(prev=>({ ...prev, activeWeekId })); }, [activeWeekId]);

          useEffect(()=>{ if('serviceWorker' in navigator){ navigator.serviceWorker.register('/sw.js').catch(()=>{}); } },[]);

          const weekIndex = db.weeks.findIndex((w)=>w.id===activeWeek?.id);
          function gotoPrevWeek(){ if(weekIndex>0) setActiveWeekId(db.weeks[weekIndex-1].id); }
          function gotoNextWeek(){ if(weekIndex<db.weeks.length-1) setActiveWeekId(db.weeks[weekIndex+1].id); }
          function startNewWeek(){ const last=db.weeks[db.weeks.length-1]; const base=deepClone(last); base.id=uid(); const nextStart=new Date(last.weekStartISO); nextStart.setDate(nextStart.getDate()+7); base.weekStartISO=nextStart.toISOString(); base.areas=base.areas.map(a=>resetCompletion(a)); base.notes=""; setDb(prev=>({...prev, weeks:[...prev.weeks, base], activeWeekId: base.id })); }
          function replaceWeek(updated){ setDb(prev=>({ ...prev, weeks: prev.weeks.map((w)=>w.id===updated.id?updated:w) })); }
          function setAreaName(areaId, name){ const w=deepClone(activeWeek); const area=w.areas.find(a=>a.id===areaId); if(area) area.name=name; replaceWeek(w); }
          function addGoal(areaId){ const w=deepClone(activeWeek); const area=w.areas.find(a=>a.id===areaId); if(!area) return; area.goals.push({ id: uid(), title: "ìƒˆ ëª©í‘œ", completed:false, actions: []}); replaceWeek(w); }
          function toggleCompleted(kind, ids){ const w=deepClone(activeWeek); for(const area of w.areas){ if(kind==="goal"){ const g=area.goals.find(g=>g.id===ids.goalId); if(g) g.completed=!g.completed; } else if(kind==="action"){ for(const g of area.goals){ const a=g.actions.find(a=>a.id===ids.actionId); if(a) a.completed=!a.completed; } } else if(kind==="subtask"){ for(const g of area.goals){ for(const a of g.actions){ const s=a.subtasks?.find(s=>s.id===ids.subtaskId); if(s) s.completed=!s.completed; }}} } replaceWeek(w); }
          function setTitle(kind, ids, title){ const w=deepClone(activeWeek); for(const area of w.areas){ for(const g of area.goals){ if(kind==="goal" && g.id===ids.goalId) g.title=title; for(const a of g.actions){ if(kind==="action" && a.id===ids.actionId) a.title=title; for(const s of a.subtasks||[]){ if(kind==="subtask" && s.id===ids.subtaskId) s.title=title; }}}} replaceWeek(w); }
          function addAction(goalId){ const w=deepClone(activeWeek); for(const area of w.areas){ for(const g of area.goals){ if(g.id===goalId){ g.actions.push({ id: uid(), title: "ìƒˆ í–‰ë™", completed:false, subtasks: []}); }}} replaceWeek(w); }
          function addSubtask(actionId){ const w=deepClone(activeWeek); for(const area of w.areas){ for(const g of area.goals){ for(const a of g.actions){ if(a.id===actionId){ a.subtasks=a.subtasks||[]; a.subtasks.push({ id: uid(), title: "ì„¸ë¶€ ìž‘ì—…", completed:false}); }}}} replaceWeek(w); }
          function removeItem(kind, ids){ const w=deepClone(activeWeek); for(const area of w.areas){ if(kind==="goal"){ area.goals = area.goals.filter(g=>g.id!==ids.goalId); } else { for(const g of area.goals){ if(kind==="action") g.actions = g.actions.filter(a=>a.id!==ids.actionId); if(kind==="subtask") for(const a of g.actions) a.subtasks=(a.subtasks||[]).filter(s=>s.id!==ids.subtaskId); }}} replaceWeek(w); }
          function moveItem(kind, ids, dir){ const w=deepClone(activeWeek); function move(arr, idKey, id){ const idx=arr.findIndex(x=>x[idKey]===id); if(idx<0) return; const ni=idx+dir; if(ni<0||ni>=arr.length) return; const t=arr[idx]; arr[idx]=arr[ni]; arr[ni]=t; } for(const area of w.areas){ if(kind==="goal") move(area.goals, "id", ids.goalId); for(const g of area.goals){ if(kind==="action") move(g.actions, "id", ids.actionId); for(const a of g.actions){ if(kind==="subtask") move(a.subtasks||[], "id", ids.subtaskId); }}} replaceWeek(w); }
          function exportJson(){ const blob = new Blob([JSON.stringify(db,null,2)], {type:"application/json"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download=`vb_tracker_${new Date().toISOString().slice(0,10)}.json`; a.click(); URL.revokeObjectURL(url); }
          function onImportJson(e){ const file=e.target.files?.[0]; if(!file) return; const reader=new FileReader(); reader.onload=()=>{ try{ const parsed=JSON.parse(reader.result); setDb(parsed); setVision(parsed.vision||{imageDataUrl:"", imageUrl:""}); setActiveWeekId(parsed.activeWeekId || parsed.weeks?.[parsed.weeks.length-1]?.id);}catch{ alert("JSON íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ì–´ìš”."); } }; reader.readAsText(file); }

          return e("div",{className:"min-h-screen bg-neutral-50 text-neutral-900"},
            e(TopBar,{page, setPage, onExport:exportJson, onImport:onImportJson}),
            e("div",{className:"max-w-screen-sm mx-auto px-3 mt-2 tip"},"Safari â†’ ê³µìœ  â†’ í™ˆ í™”ë©´ì— ì¶”ê°€ (PWA ì„¤ì¹˜)"),
            page==="dashboard" && e("main",{className:"p-3 pb-24 max-w-screen-sm mx-auto"},
              e(VisionBoard,{vision, setVision}),
              e("div",{className:"mt-4 flex items-center justify-between"},
                e("button",{onClick:gotoPrevWeek, className:"px-2 py-1 rounded-xl bg-white shadow flex items-center gap-1"},
                  e("span",{className:"icon"},"â—€ï¸Ž"), " ì´ì „"),
                e("div",{className:"text-sm font-semibold text-neutral-600"}, formatWeek(new Date(activeWeek.weekStartISO))),
                e("button",{onClick:gotoNextWeek, className:"px-2 py-1 rounded-xl bg-white shadow flex items-center gap-1"}, "ë‹¤ìŒ ", e("span",{className:"icon"},"â–¶ï¸Ž"))
              ),
              e("div",{className:"mt-2 flex items-center justify-between"},
                e("div",{className:"text-xs text-neutral-500 flex items-center gap-2"},
                  e("span",{className:"icon"},"ðŸ“…"), "í˜„ìž¬ ì£¼ê°„ ê³„íš"),
                e("button",{onClick:startNewWeek, className:"px-3 py-1 rounded-xl bg-black text-white text-xs flex items-center gap-2 shadow"},
                  e("span",{className:"icon"},"âŸ³"), " ìƒˆ ì£¼ ì‹œìž‘")
              ),
              e("div",{className:"mt-4 grid grid-cols-1 gap-3"},
                activeWeek.areas.map((area)=>
                  e(AreaCard,{
                    key:area.id, area, onRename:(name)=>setAreaName(area.id,name), onAddGoal:()=>addGoal(area.id),
                    onChange:replaceWeek, week:activeWeek, onToggle:toggleCompleted, onSetTitle:setTitle,
                    onAddAction:addAction, onAddSubtask:addSubtask, onRemove:removeItem, onMove:moveItem
                  })
                )
              ),
              e("div",{className:"mt-4"},
                e("textarea",{
                  value: activeWeek.notes||"", onChange:(ev)=>replaceWeek({...activeWeek, notes:ev.target.value}),
                  placeholder:"ì´ë²ˆ ì£¼ ë©”ëª¨", className:"w-full min-h-[80px] rounded-2xl p-3 text-sm bg-white shadow focus:outline-none"
                })
              )
            ),
            page==="history" && e(HistoryPage,{db, setActiveWeekId, setPage}),
            e(BottomNav,{page, setPage})
          );
        }

        function TopBar({ page, setPage, onExport, onImport }){
          const fileRef = useRef(null);
          return e("div",{className:"bar"},
            e("div",{className:"max-w-screen-sm mx-auto px-3 py-2 flex items-center justify-between"},
              e("div",{className:"font-semibold"},"Vision + 4 Areas"),
              e("div",{className:"flex items-center gap-1"},
                e("button",{onClick:onExport, className:"px-2 py-1 text-xs rounded-xl bg-white shadow flex items-center gap-1"},
                  e("span",{className:"icon"},"ðŸ“¤"), " ë‚´ë³´ë‚´ê¸°"),
                e("button",{onClick:()=>fileRef.current && fileRef.current.click(), className:"px-2 py-1 text-xs rounded-xl bg-white shadow flex items-center gap-1"},
                  e("span",{className:"icon"},"ðŸ“¥"), " ê°€ì ¸ì˜¤ê¸°"),
                e("input",{ref:fileRef, type:"file", accept:"application/json", onChange:onImport, className:"hidden"})
              )
            )
          );
        }

        function BottomNav({ page, setPage }){
          return e("nav",{className:"nav"},
            e("div",{className:"max-w-screen-sm mx-auto flex"},
              e(TabButton,{active:page==="dashboard", onClick:()=>setPage("dashboard"), icon:"ðŸ“š", label:"ëŒ€ì‹œë³´ë“œ"}),
              e(TabButton,{active:page==="history", onClick:()=>setPage("history"), icon:"ðŸ•˜", label:"ížˆìŠ¤í† ë¦¬"})
            )
          );
        }

        function TabButton({ active, onClick, icon, label }){
          return e("button",{onClick:onClick, className:`flex-1 py-2 text-xs flex flex-col items-center ${active ? "text-black":"text-neutral-500"}`},
            e("span",{className:"icon"},icon), e("span",{className:"mt-1"},label));
        }

        function VisionBoard({ vision, setVision }){
          const fileRef = useRef(null);
          function onPick(ev){
            const file = ev.target.files && ev.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = () => setVision(v=>({...v, imageDataUrl:String(reader.result||"")}));
            reader.readAsDataURL(file);
          }
          return e("div",{className:"rounded-2xl overflow-hidden shadow bg-white"},
            e("div",{className:"relative"},
              (vision.imageDataUrl || vision.imageUrl) ?
                e("img",{src:vision.imageDataUrl || vision.imageUrl, alt:"Vision", className:"w-full h-56 object-cover"}) :
                e("div",{className:"w-full h-56 flex flex-col items-center justify-center text-neutral-400"},
                  e("div",{className:"icon", style:{fontSize:"40px"}}, "ðŸ–¼ï¸"),
                  "ë¹„ì „ë³´ë“œ ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•˜ì„¸ìš”"
                ),
              e("div",{className:"absolute top-2 right-2 flex gap-2"},
                e("button",{onClick:()=>fileRef.current && fileRef.current.click(), className:"px-2 py-1 bg-black/80 text-white rounded-xl text-xs"},"ì‚¬ì§„ ì—…ë¡œë“œ"),
                e("input",{ref:fileRef, type:"file", accept:"image/*", onChange:onPick, className:"hidden"})
              )
            ),
            e("div",{className:"p-3 border-t"},
              e("input",{
                value: vision.imageUrl || "", onChange:(ev)=>setVision(v=>({...v, imageUrl:ev.target.value})),
                placeholder:"ì´ë¯¸ì§€ URL ë¶™ì—¬ë„£ê¸° (ì„ íƒ)", className:"w-full text-xs p-2 rounded-xl bg-neutral-50 focus:outline-none"
              })
            )
          );
        }

        function AreaCard({ area, onRename, onAddGoal, week, onToggle, onSetTitle, onAddAction, onAddSubtask, onRemove, onMove }){
          const { total, done } = countProgress(area);
          const [editing, setEditing] = useState(false);
          const [name, setName] = useState(area.name);
          useEffect(()=>setName(area.name),[area.name]);
          return e("div",{className:`rounded-2xl shadow p-3 ${area.color || "bg-white"}`},
            e("div",{className:"flex items-center justify-between"},
              e("div",{className:"flex items-center gap-2"},
                e("div",{className:"font-semibold"},
                  editing ? e("input",{value:name, onChange:(ev)=>setName(ev.target.value), onBlur:()=>{onRename(name||"ë¬´ì œ"); setEditing(false);}, className:"px-2 py-1 rounded-lg text-sm bg-white/70 focus:outline-none"}) : e("span",null,area.name)
                ),
                e("span",{className:"text-xs text-neutral-600"}, `${done}/${total}`)
              ),
              e("div",{className:"flex items-center gap-2"},
                editing ? e("button",{onClick:()=>{onRename(name||"ë¬´ì œ"); setEditing(false);}, className:"text-xs px-2 py-1 bg-white rounded-xl shadow flex items-center gap-1"}, "ðŸ’¾ ì €ìž¥") :
                         e("button",{onClick:()=>setEditing(true), className:"text-xs px-2 py-1 bg-white rounded-xl shadow flex items-center gap-1"}, "âœŽ ì´ë¦„"),
                e("button",{onClick:onAddGoal, className:"text-xs px-2 py-1 bg-white rounded-xl shadow flex items-center gap-1"}, "ï¼‹ ëª©í‘œ")
              )
            ),
            e("div",{className:"mt-2 grid gap-2"},
              area.goals.map((g)=>
                e(GoalCard,{
                  key:g.id, goal:g, onToggle:()=>onToggle("goal",{goalId:g.id}), onSetTitle:(t)=>onSetTitle("goal",{goalId:g.id}, t),
                  onAddAction:()=>onAddAction(g.id), onRemove:()=>onRemove("goal",{goalId:g.id}), onMoveUp:()=>onMove("goal",{goalId:g.id}, -1),
                  onMoveDown:()=>onMove("goal",{goalId:g.id}, 1), onToggleAction:(aid)=>onToggle("action",{actionId:aid}),
                  onTitleAction:(aid,t)=>onSetTitle("action",{actionId:aid}, t), onAddSubtask:(aid)=>onAddSubtask(aid),
                  onRemoveAction:(aid)=>onRemove("action",{actionId:aid}), onMoveAction:(aid,dir)=>onMove("action",{actionId:aid}, dir),
                  onToggleSubtask:(sid)=>onToggle("subtask",{subtaskId:sid}), onTitleSubtask:(sid,t)=>onSetTitle("subtask",{subtaskId:sid}, t),
                  onRemoveSubtask:(sid)=>onRemove("subtask",{subtaskId:sid}), onMoveSubtask:(sid,dir)=>onMove("subtask",{subtaskId:sid}, dir)
                })
              )
            )
          );
        }

        function GoalCard({ goal, onToggle, onSetTitle, onAddAction, onRemove, onMoveUp, onMoveDown,
          onToggleAction, onTitleAction, onAddSubtask, onRemoveAction, onMoveAction,
          onToggleSubtask, onTitleSubtask, onRemoveSubtask, onMoveSubtask }){
          const [t, setT] = useState(goal.title);
          useEffect(()=>setT(goal.title),[goal.title]);
          return e("div",{className:"bg-white rounded-2xl shadow p-3"},
            e("div",{className:"flex items-center justify-between"},
              e("label",{className:"flex items-center gap-2"},
                e("input",{type:"checkbox", checked:!!goal.completed, onChange:onToggle, className:"w-4 h-4"}),
                e("input",{value:t, onChange:(ev)=>setT(ev.target.value), onBlur:()=>onSetTitle(t||"(ì œëª© ì—†ìŒ)"), className:"text-sm font-medium bg-transparent focus:outline-none"})
              ),
              e("div",{className:"flex items-center gap-1"},
                e("button",{onClick:onMoveUp, className:"btn"},"â–²"),
                e("button",{onClick:onMoveDown, className:"btn"},"â–¼"),
                e("button",{onClick:onAddAction, className:"btn"},"í–‰ë™ï¼‹"),
                e("button",{onClick:onRemove, className:"btn btn-red"},"ðŸ—‘ï¸ ì‚­ì œ")
              )
            ),
            e("div",{className:"mt-2 grid gap-2"},
              (goal.actions||[]).map((a)=>
                e(ActionRow,{
                  key:a.id, action:a, onToggle:()=>onToggleAction(a.id), onSetTitle:(txt)=>onTitleAction(a.id, txt),
                  onAddSubtask:()=>onAddSubtask(a.id), onRemove:()=>onRemoveAction(a.id), onMoveUp:()=>onMoveAction(a.id, -1),
                  onMoveDown:()=>onMoveAction(a.id, 1), onToggleSubtask:(sid)=>onToggleSubtask(sid), onTitleSubtask:(sid,t)=>onTitleSubtask(sid,t),
                  onRemoveSubtask:(sid)=>onRemoveSubtask(sid), onMoveSubtask:(sid,dir)=>onMoveSubtask(sid, dir)
                })
              )
            )
          );
        }

        function ActionRow({ action, onToggle, onSetTitle, onAddSubtask, onRemove, onMoveUp, onMoveDown,
          onToggleSubtask, onTitleSubtask, onRemoveSubtask, onMoveSubtask }){
          const [t, setT] = useState(action.title);
          useEffect(()=>setT(action.title),[action.title]);
          return e("div",{className:"rounded-xl border p-2"},
            e("div",{className:"flex items-center justify-between"},
              e("label",{className:"flex items-center gap-2"},
                e("input",{type:"checkbox", checked:!!action.completed, onChange:onToggle, className:"w-4 h-4"}),
                e("input",{value:t, onChange:(ev)=>setT(ev.target.value), onBlur:()=>onSetTitle(t||"(ë¬´ì œ)"), className:"text-sm bg-transparent focus:outline-none"})
              ),
              e("div",{className:"flex items-center gap-1"},
                e("button",{onClick:onMoveUp, className:"btn"},"â–²"),
                e("button",{onClick:onMoveDown, className:"btn"},"â–¼"),
                e("button",{onClick:onAddSubtask, className:"btn"},"ì„¸ë¶€"),
                e("button",{onClick:onRemove, className:"btn btn-red"},"ðŸ—‘ï¸ ì‚­ì œ")
              )
            ),
            e("div",{className:"mt-2 grid gap-1"},
              (action.subtasks||[]).map((s)=>
                e(SubtaskRow,{
                  key:s.id, subtask:s, onToggle:()=>onToggleSubtask(s.id), onSetTitle:(txt)=>onTitleSubtask(s.id, txt),
                  onRemove:()=>onRemoveSubtask(s.id), onMoveUp:()=>onMoveSubtask(s.id, -1), onMoveDown:()=>onMoveSubtask(s.id, 1)
                })
              )
            )
          );
        }

        function SubtaskRow({ subtask, onToggle, onSetTitle, onRemove, onMoveUp, onMoveDown }){
          const [t, setT] = useState(subtask.title);
          useEffect(()=>setT(subtask.title),[subtask.title]);
          return e("div",{className:"flex items-center justify-between px-2 py-1 rounded-lg bg-neutral-50"},
            e("label",{className:"flex items-center gap-2"},
              e("input",{type:"checkbox", checked:!!subtask.completed, onChange:onToggle, className:"w-4 h-4"}),
              e("input",{value:t, onChange:(ev)=>setT(ev.target.value), onBlur:()=>onSetTitle(t||"(ì„¸ë¶€)"), className:"text-sm bg-transparent focus:outline-none"})
            ),
            e("div",{className:"flex items-center gap-1"},
              e("button",{onClick:onMoveUp, className:"btn"},"â–²"),
              e("button",{onClick:onMoveDown, className:"btn"},"â–¼"),
              e("button",{onClick:onRemove, className:"btn btn-red"},"ðŸ—‘ï¸ ì‚­ì œ")
            )
          );
        }

        function HistoryPage({ db, setActiveWeekId, setPage }){
          return e("main",{className:"p-3 pb-24 max-w-screen-sm mx-auto"},
            e("div",{className:"text-sm text-neutral-600 mb-2"},"ì§€ë‚œ ì£¼ì°¨ ê¸°ë¡ì„ ê°„ë‹¨ížˆ í™•ì¸í•˜ê³  ì—´ëžŒí•  ìˆ˜ ìžˆì–´ìš”."),
            e("div",{className:"grid gap-2"},
              db.weeks.map((w,i)=> e("button",{key:w.id, onClick:()=>{ setActiveWeekId(w.id); setPage("dashboard"); }, className:"w-full text-left bg-white rounded-2xl shadow p-3"},
                e("div",{className:"flex items-center justify-between"},
                  e("div",{className:"font-medium"}, formatWeek(new Date(w.weekStartISO))),
                  e("div",{className:"text-xs text-neutral-500"}, i===db.weeks.length-1 ? "ìµœê·¼" : `${db.weeks.length-1-i}ì£¼ ì „`)
                ),
                e("div",{className:"mt-2 grid grid-cols-2 gap-2"},
                  w.areas.map((a)=>{ const { total, done } = countProgress(a); const pct = total ? Math.round((done/total)*100) : 0;
                    return e("div",{key:a.id, className:"text-xs flex items-center justify-between bg-neutral-50 rounded-xl px-2 py-1"},
                      e("span",{className:"truncate"}, a.name),
                      e("span",{className:"tabular-nums"}, `${done}/${total} (${pct}%)`)
                    );
                  })
                ),
                w.notes && e("div",{className:"mt-2 text-xs text-neutral-600 line-clamp-2"},"ë©”ëª¨: ", w.notes)
              ))
            )
          );
        }

        // Mount
        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(React.createElement(App));
      })();
    </script>

    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').catch(()=>{});
        });
      }
    </script>

    <div style="display:none"><!-- .nojekyll placeholder --></div>
  </body>
</html>